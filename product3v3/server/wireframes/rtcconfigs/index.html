<!DOCTYPE html>







<html lang="en">
<head>
  
  

  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta name=viewport content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="chrome=1,IE=edge">
  

  
  <link rel="stylesheet" href="https://mmclssg1.github.io/ssdocs/css/docstyles.css?v=2018-05-11-1111" type="text/css" media="all">
  

  
  
  
  <script src="https://mmclssg1.github.io/ssdocs/js/jquery.min.js?v=2018-05-11-1111"></script>
  <script>
    !window.jQuery && document.write(unescape('%3Cscript src="https:\/\/mmclssg1.github.io\/ssdocs/js/jquery.min.js"%3E%3C/script%3E'))
  </script>
  <script type="text/javascript" src="https://mmclssg1.github.io/ssdocs/js/balsamiq-complete.min.js?v=2018-05-11-1111"></script>
  
  

  
  <link rel="stylesheet" href="https://mmclssg1.github.io/ssdocs/css/dbc.css?v=2018-05-11-1111" type="text/css" media="all">
  <script src="https://mmclssg1.github.io/ssdocs/js/dbc.min.js?v=2018-05-11-1111"></script>
  
<link rel="alternate" href="/index.xml" type="application/rss+xml" title="Documentation">
<title>


  
    Real Time Collaboration Service Configuration [Balsamiq Wireframes for Confluence Server] -
  

Documentation
</title>
</head>
<body class="company-support-portal dbc">
  
  
  

<div id="page-wrapper">
  
  <header id="header-wrapper">
    <nav class="navbar">
    <div id="header" class="container-fluid">
      <div class="row">
        
        <div class="col-xs-12">
          <div id="site-nav" class="navbar-header">
            <button id="rmenu" type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#gnav">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            
            <a href="https://mmclssg1.github.io/ssdocs" id="site-id">Documentation</a>
          </div>
          
          <div class="collapse navbar-collapse" id="gnav">
            <ul class="menubar gnav nav navbar">
            <li id="gnav-cloud">
                <a href="https://mmclssg1.github.io/ssdocs/product1/" class="gnava">Product 1</a>
              </li>
              <li id="gnav-desktop">
                <a href="https://mmclssg1.github.io/ssdocs/product2/" class="gnava">Product 2</a>
              </li>
              <li id="gnav-plugins" class="hidden-xs">
                <a href="#" class="gnava dropdown" class="dropdown-toggle" id="dDocs" data-toggle="dropdown" data-target="#">Product 3 <i class="ss-icon" style="font-size:7px">&#xF501;</i></a>
                <ul class="dropdown-menu nav" aria-labelledby="dDocs">
                  <li><a href="https://mmclssg1.github.io/ssdocs/product3v1/product3v1_1/">Version 1.0</a></li>
                  <li><a href="https://mmclssg1.github.io/ssdocs/product3v2/">Version 2.0</a></li>
                  <li><a href="https://mmclssg1.github.io/ssdocs/product3v3/">Version 3.0</a></li>
                </ul>
              </li>
              <li id="gnav-gdrive" class="visible-xs"><a href="https://mmclssg1.github.io/ssdocs/product3v1/product3v1_1/" class="gnava">Version 1.0</a></li>
              <li id="gnav-confluence" class="visible-xs"><a href="https://mmclssg1.github.io/ssdocs/product3v2/" class="gnava">Version 2.0</a></li>
              <li id="gnav-jira" class="visible-xs"><a href="https://mmclssg1.github.io/ssdocs/product3v3/" class="gnava">Version 3.0</a></li>
              <li id="gnav-mybalsamiq">
                <a href="https://mmclssg1.github.io/ssdocs/product4/" class="gnava">Product 4</a>
              </li>
              

              
              <li id="gnav-search" class="visible-xs visible-sm">
                <a href="https://mmclssg1.github.io/ssdocs/search/" class="gnava"><span class="visible-sm hidden-xs"><i class="ss-icon ss-search"></i></span><span class="visible-xs hidden-sm">Search</span></a>
              </li>
              <li id="gnav-search-form" class="hidden-xs hidden-sm last">

              <div id="search">
                  <form class="search" action="search/" method="get" id="searchInNav">
                    <div id="navSearchDiv">
                    <input id="s" accesskey="s" type="text" value="Search..." name="q" tabindex="1" autocomplete="off"/>
                    <input id="ss" type="submit" value="Search" tabindex="2"/>
                    </div>
                  </form>
                  <script type="text/javascript">
                    BalsamiqSearchAutoComplete.initAutoCompleteInputDiv("navSearchDiv");
                  </script>

                  
                </div>
              </li>
            </ul>
          </div>
          
        </div>
      </div>
    </div>
    </nav>
  </header>
  

  
  <div id="body-wrapper">





<div id="body-main">
  <div class="container-fluid">


<div class="row">

  <div class="local-nav local-nav-1 hidden-xs hidden-sm col-md-3">
    <div id="sidebar-box">
		


<h5><a href="#" data-toggle="collapse" data-target="#doc-menu" aria-expanded="false" aria-controls="doc-menu" class="menu-toggle"><i class="ss-icon ss-navigateright"></i> Balsamiq Wireframes for Confluence Server</a></h5>
<ul id="doc-menu" class="collapse">
  
  <li><a href="/ssdocs/product3v3/server/wireframes/"> Table of Contents </a> </li>
    
  <li><a href="/ssdocs/product3v3/server/wireframes/intro/"> Introduction to Balsamiq Wireframes for Confluence Server </a> </li>
    
  <li><a href="/ssdocs/product3v3/server/wireframes/admin-guide/"> Balsamiq Wireframes for Confluence Server Admin Guide </a> </li>
    
  <li><a href="/ssdocs/product3v3/server/wireframes/transition-guide/"> Balsamiq Wireframes for Confluence Server Transition Guide </a> </li>
    
  <li><a href="/ssdocs/product3v3/server/wireframes/rtc-troubleshooting/"> Real-Time Collaboration Service Troubleshooting </a> </li>
    
  <li class="active"><a href="/ssdocs/product3v3/server/wireframes/rtcconfigs/"> Real-Time Collaboration Service Configuration </a> </li>
    
  <li><a href="/ssdocs/product3v3/server/wireframes/overview/"> Editor Overview </a> </li>
    
  <li><a href="/ssdocs/product3v3/server/wireframes/adding-controls/"> Adding and Arranging UI Controls </a> </li>
    
  <li><a href="/ssdocs/product3v3/server/wireframes/editing-controls/"> Editing UI Controls </a> </li>
    
  <li><a href="/ssdocs/product3v3/server/wireframes/sharing/"> Sharing and Reviewing </a> </li>
    
  <li><a href="/ssdocs/product3v3/server/wireframes/collaborating/"> Collaborative Editing </a> </li>
    
  <li><a href="/ssdocs/product3v3/server/wireframes/images/"> Using Images, Assets, and Icons </a> </li>
    
  <li><a href="/ssdocs/product3v3/server/wireframes/symbols/"> Symbols </a> </li>
    
  <li><a href="/ssdocs/product3v3/server/wireframes/markup/"> Markup </a> </li>
    
  <li><a href="/ssdocs/product3v3/server/wireframes/linking/"> Linking Wireframes Together </a> </li>
    
  <li><a href="/ssdocs/product3v3/server/wireframes/fullscreen/"> Full Screen Presentation Mode </a> </li>
    
  <li><a href="/ssdocs/product3v3/server/wireframes/alternates/"> Alternates </a> </li>
    
  <li><a href="/ssdocs/product3v3/server/wireframes/exporting/"> Exporting </a> </li>
    
  <li><a href="/ssdocs/product3v3/server/wireframes/importing/"> Importing </a> </li>
    
  <li><a href="/ssdocs/product3v3/server/wireframes/shortcuts/"> Keyboard Shortcuts </a> </li>
    
</ul>

		
        
    
    <div id="toc">
	<h5><a href="#" data-toggle="collapse" data-target="#toc-menu" aria-expanded="false" aria-controls="toc-menu" class="menu-toggle"><i class="ss-icon ss-navigatedown"></i> On This Page</a></h5>
	<div id="toc-menu" class="collapse in"></div>
</div>

    </div>
  </div>

  <div id="page-article" class="col-xs-12 col-md-9">
    <div id="support-main">
      <div class="support-body">
        <article>
          
          <h5 class="subtitle"><a href='../'>Balsamiq Wireframes for Confluence Server</a></h5>
          
          <h1 class="title mt0">Real-Time Collaboration Service Configuration</h1>
          <div class="breadcrumbs visible-xs visible-sm"><div id="breadcrumbs">
  <span><a href="https://mmclssg1.github.io/ssdocs">home</a></span>

  &gt; <span><a href='../'>Balsamiq Wireframes for Confluence Server</a></span>

  &gt; <span>Real-Time Collaboration Service Configuration</span>
</div>
</a></div>
          <div class="article-content content article">
            
              

<p>Our Atlassian server add-ons include a built-in, behind the firewall <strong>real-time collaboration service</strong> (RTC) that allows multiple users to work on the same project, at the same time. This documentation is to help administrators understand how the service is implemented, and potentially help them solve problems with it.</p>

<p>It&rsquo;s a service on the main application server that needs to be configured according to the existing network layout. Except for common setups (direct connection to tomcat), you need administration access to the server console to edit reverse proxy configuration files or open the desired port.</p>

<p>Confluence/Jira administration permissions are needed to modify the RTC plugin configuration (set the FQDN, set the RTC port, verify if RTC is up or restart it).</p>

<span class="alert alert-warning show" role="alert"><p><strong>Note:</strong> To avoid mixed content (HTTP+HTTPS on the same webpage), the connection protocol has to be the same (client/server and RTC), so HTTP for both or HTTPS for both.</p>

<p>Example: if SSL is terminated at the reverse proxy, and proxied to HTTP (tomcat), the same thing should happen for RTC (default port 9083-9093)</p>
</span>

<hr />

<h2 id="possible-configurations">Possible Configurations</h2>

<p>JIRA/Confluence application server can be installed with different network configurations. Depending on the configuration, the RTC configuration page shows different protocol values:</p>

<p>If the protocol field in the configuration page shows HTTP, the plugin is guessing that the protocol during the full network path (client/&lt;proxy if existing&gt;/server) is HTTP.</p>

<p><img src="//media.balsamiq.com/img/support/docs/atlassian/rtc_http.png" alt="" /></p>

<p>If it shows HTTPS, the protocol used is HTTPS for all the network path.</p>

<p><img src="//media.balsamiq.com/img/support/docs/atlassian/rtc_https.png" alt="" /></p>

<p>If it shows HTTP + SSL, the protocol used is HTTPS to the reverse proxy, then HTTP to the tomcat server.</p>

<p><img src="//media.balsamiq.com/img/support/docs/atlassian/rtc_http+ssl.png" alt="" /></p>

<p>Here are different network configurations related to protocol value (shown in RTC plugin configuration page):</p>

<ul>
<li><a href="#http-configuration-examples">HTTP configuration examples</a></li>
<li><a href="#http-ssl-configuration-examples">HTTP + SSL configuration examples</a></li>
<li><a href="#https-configuration-examples">HTTPS configuration examples</a></li>
</ul>

<hr />

<h2 id="prerequisites">Prerequisites</h2>

<h3 id="prerequisites-valid-for-every-scenario">Prerequisites valid for every scenario</h3>

<ul>
<li>It is possible to configure a desired port (that has to be free and beyond 1024, according to best practices) through the plugin configuration tab &ldquo;Real-time Collaboration Service&rdquo; (9083 is the default for confluence, 9093 for Jira).</li>
<li>The selected TCP port for RTC has to be available and reachable on all the network path.
verify that the fully qualified domain name of the server (or the proxy, in case of reverse proxy) is correct.</li>
<li>In most cases, it&rsquo;s the same as the FQDN of the Atlassian Server Base URL (if the Server Base URL is http://<span></span>example.com/JIRA, the Server Name in the plugin configuration name has to be example.com</li>
</ul>

<h3 id="prerequisites-in-case-of-reverse-proxy">Prerequisites in case of reverse proxy</h3>

<ul>
<li>The selected TCP port for RTC has to be proxied to the application server (to the same port)</li>
<li>proxy FQDN has to be solved and reachable by the application server</li>
</ul>

<h3 id="prerequisites-in-case-of-http-ssl">Prerequisites in case of HTTP + SSL</h3>

<ul>
<li>If the proxy is on the same host of the application server, tomcat server should be listening on a different IP (typically, with the parameter address=&ldquo;127.0.0.1&rdquo; inside server.xml) so that RTC connects to proxy on chosen port in the external interface (e.g. 192.168.1.64), then can be redirected to the same port the tomcat interface</li>
<li>The Java runtime environment embedded in jira/confluence installation has to trust the SSL certificate of the proxy, so in case it is self signed or the root certificate unknown to Jre, it has to be imported into the embedded Jre.</li>
</ul>

<h3 id="prerequisites-for-https">Prerequisites for HTTPS</h3>

<ul>
<li>If tomcat directly terminate https, server.xml has to be configured to let Tomcat use the certificate file. RTC plugin reads these values directly from server.xml</li>
<li>the Java runtime environment embedded in jira/confluence installation has to trust the SSL certificate, so in case it is self signed or the root certificate unknown to Jre, it has to be imported into the embedded Jre.</li>
</ul>

<h3 id="prerequisites-for-both-https-and-http-ssl">Prerequisites for both HTTPS and HTTP+SSL</h3>

<p><strong>CA chain - HTTPS, HTTP+SSL:</strong></p>

<p>Please pay attention that the application server (Tomcat) needs to access the proxy or the application server, so the full CA chain has to be trusted. If for testing purposes SSL certificate is self signed, it has to be imported at jre level in a similar way:</p>

<pre><code>echo -n | openssl s_client -connect &lt;jira|confluence_FQDN&gt;:443 | sed -ne '/-BEGIN CERTIFICATE-/,/-END CERTIFICATE-/p' &gt; /tmp/&lt;jira|confluence_FQDN&gt;.cert

cd /opt/atlassian/&lt;confluence|jira&gt;/jre/bin

./keytool -keystore ../lib/security/cacerts -import -alias jira -file /tmp/&lt;jira|confluence_FQDN&gt;.cert
</code></pre>

<hr />

<h2 id="http-configuration-examples">HTTP Configuration Examples</h2>

<ul>
<li><a href="#http-direct-connection">HTTP - direct connection</a></li>
</ul>

<p><img src="//media.balsamiq.com/img/support/docs/atlassian/http0.png" alt="" /></p>

<ul>
<li><a href="#http-proxy-on-different-server">HTTP - proxy on different server</a></li>
</ul>

<p><img src="//media.balsamiq.com/img/support/docs/atlassian/http1.png" alt="" /></p>

<ul>
<li><a href="#http-proxy-on-same-server">HTTP - proxy on same server</a></li>
</ul>

<p><img src="//media.balsamiq.com/img/support/docs/atlassian/http2.png" alt="" /></p>

<ul>
<li><a href="#http-data-center">HTTP - data center</a></li>
</ul>

<p><img src="//media.balsamiq.com/img/support/docs/atlassian/http3.png" alt="" /></p>

<h3 id="http-direct-connection">HTTP - direct connection</h3>

<p>Client connects (http) directly to tomcat (Atlassian service), no extra configuration is required. See the Prerequisites on <a href="#prerequisites">this section</a>.</p>

<p><a href="#http-configuration-examples">See all HTTP configurations</a>.</p>

<h3 id="http-proxy-on-different-server">HTTP - proxy on different server</h3>

<p>Client connects to reverse proxy that pass the request (http) to Atlassian service. Reverse proxy and Atlassian service are on different machines. See the Prerequisites on <a href="#prerequisites">this section</a>.</p>

<h4 id="nginx-typical-config-file">nginx typical config file</h4>

<pre><code>#Confluence application server
server {
    listen &lt;FQDN__or__staticIP&gt;;
    server_name &lt;FQDN&gt;;

    location /confluence {
        proxy_set_header X-Forwarded-Host $host;
        proxy_set_header X-Forwarded-Server $host;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_pass http://&lt;tomcatFQDN__or__tomcatStaticIP&gt;/confluence;
        client_max_body_size 100M;
        proxy_buffer_size 8k;
    }
}

#RTC configuration for Balsamiq Wireframes
server {
    listen &lt;FQDN__or__staticIP&gt;:9083;
    server_name &lt;FQDN&gt;;

    location / {
        proxy_pass http://&lt;tomcatFQDN__or__tomcatStaticIP&gt;:9083;
        include proxy_params;
        proxy_redirect off;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection &quot;Upgrade&quot;;
    }
}
</code></pre>

<h4 id="rtc-apache-2-4-config-example">RTC apache 2.4 config example</h4>

<pre><code>Listen &lt;FQDN__or__staticIP&gt;:9083
&lt;VirtualHost *:9083&gt;
ProxyRequests off
ProxyPreserveHost On
RewriteEngine on

### ok for apache 2.4, comment out in apache 2.2 ###
&lt;Proxy *&gt;
Require all granted
&lt;/Proxy&gt;
### end section to comment out ###

ProxyPass / http://&lt;tomcatFQDN__or__tomcatStaticIP&gt;:9083/
RewriteEngine on
RewriteCond %{HTTP:UPGRADE} ^WebSocket$ [NC]
RewriteCond %{HTTP:CONNECTION} Upgrade$ [NC]
RewriteRule .* ws://&lt;tomcatFQDN__or__tomcatStaticIP&gt;:9083%{REQUEST_URI} [P]
&lt;/VirtualHost&gt;
</code></pre>

<h4 id="haproxy-typical-config-file">haproxy typical config file</h4>

<pre><code>#add X-Forwarded-For headers
   option forwardfor

frontend ft_jdc
    bind :80
    default_backend bk_jdc

backend bk_jdc
    server s11 192.168.1.61:8080

frontend ft_jrtc
    bind :9093
    default_backend bk_jrtc

backend bk_jrtc
    server s11 192.168.1.61:9093
</code></pre>

<p><a href="#http-configuration-examples">See all HTTP configurations</a>.</p>

<h3 id="http-proxy-on-same-server">HTTP - proxy on same server</h3>

<p>Client connects (http) to reverse proxy that pass the request (http) to Atlassian service. Reverse proxy and Atlassian service are on the same machine. See the Prerequisites on <a href="#prerequisites">this section</a>.</p>

<p>Similar to <a href="#http-proxy-on-different-server">HTTP - proxy on different server</a>, except for:</p>

<ul>
<li>reverse proxy has to listen to public interface and redirect to loopback (127.0.0.1)</li>
<li>tomcat (Atlassian service) has to be configured to listen to loopback interface (127.0.0.1)</li>
</ul>

<h4 id="server-xml-example">server.xml Example</h4>

<pre><code>&lt;Server port=&quot;8000&quot; shutdown=&quot;SHUTDOWN&quot; debug=&quot;0&quot;&gt;
    &lt;Service name=&quot;Tomcat-Standalone&quot;&gt;
        &lt;Connector port=&quot;8090&quot; connectionTimeout=&quot;20000&quot; redirectPort=&quot;8443&quot;
                address=&quot;127.0.0.1&quot;
                maxThreads=&quot;48&quot; minSpareThreads=&quot;10&quot;
                enableLookups=&quot;false&quot; acceptCount=&quot;10&quot; debug=&quot;0&quot; URIEncoding=&quot;U$
                proxyPort=&quot;80&quot;
                proxyName=&quot;s07.kvm.gozzi&quot;
                scheme=&quot;http&quot;
                maxPostSize=&quot;2097152&quot;
                protocol=&quot;org.apache.coyote.http11.Http11NioProtocol&quot; /&gt;
</code></pre>

<h4 id="nginx-sites-configuration-example">nginx sites configuration Example</h4>

<pre><code>#Confluence application server
server {
    listen &lt;FQDN__or__staticIP&gt;:80;
    server_name &lt;FQDN&gt;;

    location / {
        proxy_set_header X-Forwarded-Host $host;
        proxy_set_header X-Forwarded-Server $host;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_pass http://127.0.0.1:8090;
        client_max_body_size 100M;
        proxy_buffer_size 8k;
    }
}

upstream confluence_rtc {
        server 127.0.0.1:9083;
        keepalive 60;
}

#RTC configuration for Balsamiq Wireframes
server {
    listen &lt;FQDN__or__staticIP&gt;:9083;
    server_name &lt;FQDN&gt;;
    proxy_read_timeout 86400s;

    location / {
        proxy_pass http://confluence_rtc;
        proxy_redirect off;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection &quot;Upgrade&quot;;
    }
}
</code></pre>

<h4 id="apache-2-4-reverse-proxy-example">apache 2.4 reverse proxy Example</h4>

<pre><code>&lt;VirtualHost *:80&gt;
    ServerName &lt;FQDN&gt;
    ProxyRequests Off

    &lt;Proxy *&gt;
         Require all granted
    &lt;/Proxy&gt;

    ProxyPass /synchrony http://127.0.0.1:8091/synchrony

    &lt;Location /synchrony&gt;
    Require all granted
    RewriteEngine on
        RewriteCond %{HTTP:UPGRADE} ^WebSocket$ [NC]
        RewriteCond %{HTTP:CONNECTION} Upgrade$ [NC]
        RewriteRule .* ws://127.0.0.1:8091%{REQUEST_URI} [P]
     &lt;/Location&gt;

    ProxyPass &quot;/confluence&quot;  &quot;http://127.0.0.1:8090/confluence&quot;
    ProxyPassReverse &quot;/confluence&quot;  &quot;http://127.0.0.1:8090/confluence&quot;

        ErrorLog ${APACHE_LOG_DIR}/error.log
        CustomLog ${APACHE_LOG_DIR}/access.log combined
&lt;/VirtualHost&gt;


Listen &lt;FQDN__or__staticIP&gt;:9083
&lt;VirtualHost *:9083&gt;
  ProxyRequests off
  ProxyPreserveHost On
  RewriteEngine on

### ok for apache 2.4, comment out in apache 2.2 ###
&lt;Proxy *&gt;
Require all granted
&lt;/Proxy&gt;
### end section to comment out ###

   ProxyPass /socket.io http://127.0.0.1:9083/socket.io
    &lt;Location /socket.io&gt;
        Require all granted
        RewriteEngine on
        RewriteCond %{HTTP:UPGRADE} ^WebSocket$ [NC]
        RewriteCond %{HTTP:CONNECTION} Upgrade$ [NC]
        RewriteRule .* ws://127.0.0.1:9083%{REQUEST_URI} [P]
     &lt;/Location&gt;
&lt;/VirtualHost&gt;
</code></pre>

<p><a href="#http-configuration-examples">See all HTTP configurations</a>.</p>

<h3 id="http-data-center">HTTP data center</h3>

<p>Client connects (http) to reverse proxy that balance the request (http) to Atlassian Data Center. Reverse proxy is configured to allow <strong>balance for tomcat (sticky mode)</strong> and <strong>failover for RTC</strong> (at now RTC does not support full cluster). See the Prerequisites on <a href="#prerequisites">this section</a>.</p>

<h4 id="haproxy-2-nodes">haproxy, 2 nodes</h4>

<pre><code>frontend ft_cf_http
   bind :80
    #CORS
    capture request header origin len 128
    http-response add-header Access-Control-Allow-Origin %[capture.req.hdr(0)] if { capture.req.hdr(0) -m found }
    rspadd Access-Control-Allow-Methods:\ GET,\ HEAD,\ OPTIONS,\ POST,\ PUT  if { capture.req.hdr(0) -m found }
    rspadd Access-Control-Allow-Credentials:\ true  if { capture.req.hdr(0) -m found }
    rspadd Access-Control-Allow-Headers:\ Origin,\ Accept,\ X-Requested-With,\ Content-Type,\ Access-Control-Request-Method,\ Access-Control-Reque$
   default_backend bk_cf_http

backend bk_cf_http
   balance roundrobin
   cookie JSESSIONID prefix nocache
   server s12 192.168.1.62:8090 check cookie s12
   server s13 192.168.1.63:8090 check cookie s13

frontend ft_cf_rtc
   bind :9083 ssl crt /etc/ssl/private/haproxy.pem
   default_backend bk_cf_rtc

backend bk_cf_rtc
  option tcp-check
  server s12 192.168.1.62:9083 check port 8090
  server s13 192.168.1.63:9083 check port 8090 backup
</code></pre>

<p><a href="#http-configuration-examples">See all HTTP configurations</a>.</p>

<hr />

<h2 id="http-ssl-configuration-examples">HTTP + SSL configuration examples</h2>

<ul>
<li><a href="#http-ssl-proxy-on-different-server">HTTP+SSL - proxy on different server</a></li>
</ul>

<p><img src="//media.balsamiq.com/img/support/docs/atlassian/http+ssl1.png" alt="" /></p>

<ul>
<li><a href="#http-ssl-proxy-on-same-server">HTTP+SSL - proxy on same server</a></li>
</ul>

<p><img src="//media.balsamiq.com/img/support/docs/atlassian/http+ssl2.png" alt="" /></p>

<ul>
<li><a href="#http-ssl-data-center">HTTP+SSL - data center</a></li>
</ul>

<p><img src="//media.balsamiq.com/img/support/docs/atlassian/http+ssl3.png" alt="" /></p>

<h3 id="http-ssl-proxy-on-different-server">HTTP+SSL - proxy on different server</h3>

<p>Client connects (https) to reverse proxy that pass the request (http) to Atlassian service (on different machines). See the Prerequisites on <a href="#prerequisites">this section</a>. For CA chain please look also at <a href="#prerequisites-for-both-https-and-http-ssl">this section</a>.</p>

<p>Similar to <a href="#http-proxy-on-different-server">HTTP - proxy on different server</a>, except for the certificate declarations and for the listening ports (ssl).</p>

<h4 id="nginx-config-example">nginx config example</h4>

<pre><code>#JIRA application server
server {
    listen &lt;FQDN__or__staticIP&gt;:443 ssl;
    server_name &lt;FQDN&gt;;

    ssl_certificate /etc/nginx/ssl/nginx.crt;
    ssl_certificate_key /etc/nginx/ssl/nginx.key;

    location /JIRA {
        proxy_set_header X-Forwarded-Host $host;
        proxy_set_header X-Forwarded-Server $host;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_pass http://&lt;tomcatFQDN__or__tomcatStaticIP&gt;:8080/JIRA;
        client_max_body_size 20M;
        proxy_buffer_size 8k;
    }
}


#RTC configuration for Balsamiq Wireframes
server {
        listen &lt;FQDN__or__staticIP&gt;:8092 ssl;
        server_name &lt;FQDN&gt;;

        ssl_certificate /etc/nginx/ssl/nginx.crt;
        ssl_certificate_key /etc/nginx/ssl/nginx.key;

location / {
            proxy_pass http://&lt;tomcatFQDN__or__tomcatStaticIP&gt;:8092/;
            include proxy_params;
            proxy_redirect off;
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection &quot;Upgrade&quot;;
    }
}
</code></pre>

<h4 id="haproxy-configuration-example">haproxy configuration example</h4>

<pre><code>#add X-Forwarded-For headers
   option forwardfor

frontend ft_jdc_ssl
   bind :443 ssl crt /etc/ssl/private/haproxy.pem

backend bk_jdc
   server s11 192.168.1.61:8080

frontend ft_jrtc_ssl
   bind :9093 ssl crt /etc/ssl/private/haproxy.pem
   default_backend bk_jrtc_ssl

backend bk_jrtc_ssl
  server s11 192.168.1.61:9093
# server &lt;server_name&gt; &lt;tomcatFQDN__or__tomcatStaticIP&gt;:&lt;Rtc_port&gt;
</code></pre>

<h4 id="apache-2-4-configuration-file-example">apache 2.4 configuration file example</h4>

<pre><code>### for balsamiq RTC
Listen &lt;FQDN__or__staticIP&gt;:9083
&lt;VirtualHost *:9083&gt;
    SSLEngine on
    SSLCertificateFile      /etc/ssl/certs/apache-selfsigned.crt
    SSLCertificateKeyFile /etc/ssl/private/apache-selfsigned.key
    ProxyRequests off
    ProxyPreserveHost On
    RewriteEngine on

### ok for apache 2.4, comment out in apache 2.2 ###
&lt;Proxy *&gt;
Require all granted
&lt;/Proxy&gt;
### end section to comment out ###

    ProxyPass / http://&lt;tomcatFQDN__or__tomcatStaticIP&gt;:9083/
    RewriteEngine on
    RewriteCond %{HTTP:UPGRADE} ^WebSocket$ [NC]
    RewriteCond %{HTTP:CONNECTION} Upgrade$ [NC]
    RewriteRule .* ws://&lt;tomcatFQDN__or__tomcatStaticIP&gt;:9083%{REQUEST_URI} [P]
&lt;/VirtualHost&gt;
</code></pre>

<p><a href="#http-ssl-configuration-examples">See all HTTP+SSL configurations</a>.</p>

<h3 id="http-ssl-proxy-on-same-server">HTTP+SSL - proxy on same server</h3>

<p>Client connects (https) to reverse proxy that pass the request (http) to Atlassian service. Reverse proxy and Atlassian service are on the same machine (address=127.0.0.1 inside server.xml). See the Prerequisites on <a href="#prerequisites">this section</a>. For CA chain please look also at <a href="#prerequisites-for-both-https-and-http-ssl">this section</a>.</p>

<h4 id="server-xml">server.xml</h4>

<pre><code>&lt;Connector port=&quot;8090&quot; connectionTimeout=&quot;20000&quot; redirectPort=&quot;8443&quot;
        address=&quot;127.0.0.1&quot;
        maxThreads=&quot;48&quot; minSpareThreads=&quot;10&quot;
        enableLookups=&quot;false&quot; acceptCount=&quot;10&quot; debug=&quot;0&quot; URIEncoding=&quot;U$
        proxyPort=&quot;443&quot;
        proxyName=&quot;example.com&quot;
        scheme=&quot;https&quot;
        maxPostSize=&quot;2097152&quot;
        protocol=&quot;org.apache.coyote.http11.Http11NioProtocol&quot; /&gt;
</code></pre>

<h4 id="nginx-config-file">nginx config file</h4>

<pre><code>#Confluence application server
server {
    listen &lt;FQDN__or__staticIP&gt;:443 ssl;
    server_name &lt;FQDN&gt;;

    ssl_certificate               /etc/ssl/certs/nginx-selfsigned.crt;
    ssl_certificate_key           /etc/ssl/private/nginx-selfsigned.key;


    location / {
        proxy_set_header X-Forwarded-Host $host;
        proxy_set_header X-Forwarded-Server $host;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_pass http://127.0.0.1:8090;
        client_max_body_size 100M;
        proxy_buffer_size 8k;
    }
}

upstream confluence_rtc {
        server 127.0.0.1:9093;
        keepalive 60;
}

#RTC configuration for Balsamiq Wireframes
server {
    listen &lt;FQDN__or__staticIP&gt;:9093 ssl;
    server_name &lt;FQDN&gt;;

    proxy_read_timeout 86400s;

    ssl_certificate               /etc/ssl/certs/nginx-selfsigned.crt;
    ssl_certificate_key           /etc/ssl/private/nginx-selfsigned.key;

    location / {
        proxy_pass http://confluence_rtc;
        proxy_redirect off;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection &quot;Upgrade&quot;;
    }
}
</code></pre>

<h4 id="apache-2-4-configuration-file-example-1">apache 2.4 configuration file example</h4>

<pre><code>#### standard confluence section
   &lt;VirtualHost *:443&gt;
    ServerName &lt;FQDN&gt;
    SSLEngine on
    SSLCertificateFile      /etc/ssl/certs/apache-selfsigned.crt
    SSLCertificateKeyFile /etc/ssl/private/apache-selfsigned.key
    ProxyRequests Off
    ProxyPreserveHost On
###comment out in case of apache 2.2
    &lt;Proxy *&gt;
         Require all granted
    &lt;/Proxy&gt;
### end section to comment

   ProxyPass /synchrony http://127.0.0.1:8091/synchrony
    &lt;Location /synchrony&gt;
        Require all granted
        RewriteEngine on
        RewriteCond %{HTTP:UPGRADE} ^WebSocket$ [NC]
        RewriteCond %{HTTP:CONNECTION} Upgrade$ [NC]
        RewriteRule .* ws://127.0.0.1:8091%{REQUEST_URI} [P]
     &lt;/Location&gt;

    ProxyPass /confluence  http://127.0.0.1:8090/confluence
    ProxyPassReverse /confluence  http://127.0.0.1:8090/confluence

    &lt;Location /confluence&gt;
        Require all granted
    &lt;/Location&gt;
    &lt;/VirtualHost&gt;
#### end of confluence section

### balsamiq rtc section
Listen &lt;FQDN__or__staticIP&gt;:9083
&lt;VirtualHost *:9083&gt;
SSLEngine on
SSLCertificateFile /etc/ssl/certs/apache-selfsigned.crt
SSLCertificateKeyFile /etc/ssl/private/apache-selfsigned.key
ProxyRequests off
ProxyPreserveHost On
RewriteEngine on

### ok for apache 2.4, comment out in apache 2.2 ###
&lt;Proxy *&gt;
Require all granted
&lt;/Proxy&gt;
### end section to comment out ###

ProxyPass / http://127.0.0.1:9083/
RewriteEngine on
RewriteCond %{HTTP:UPGRADE} ^WebSocket$ [NC]
RewriteCond %{HTTP:CONNECTION} Upgrade$ [NC]
RewriteRule .* ws://127.0.0.1:9083%{REQUEST_URI} [P]
&lt;/VirtualHost&gt;
###end of balsamiq rtc section
</code></pre>

<p><a href="#http-ssl-configuration-examples">See all HTTP+SSL configurations</a>.</p>

<h3 id="http-ssl-data-center">HTTP+SSL - data center</h3>

<p>Client connects (https) to reverse proxy that pass the request (http) to Atlassian Data Center. Reverse proxy is configured to allow balance for tomcat and failover for RTC (as at now RTC does not support full cluster). See the Prerequisites on <a href="#prerequisites">this section</a>. For CA chain please look also at <a href="#prerequisites-for-both-https-and-http-ssl">this section</a>.</p>

<h4 id="haproxy-example">haproxy example</h4>

<pre><code>frontend ft_cf_https
   bind :443 ssl crt /etc/ssl/private/haproxy.pem
 # Add CORS headers when Origin header is present
    capture request header origin len 128
    http-response add-header Access-Control-Allow-Origin %[capture.req.hdr(0)] if { capture.req.hdr(0) -m found }
    rspadd Access-Control-Allow-Methods:\ GET,\ HEAD,\ OPTIONS,\ POST,\ PUT  if { capture.req.hdr(0) -m found }
    rspadd Access-Control-Allow-Credentials:\ true  if { capture.req.hdr(0) -m found }
    rspadd Access-Control-Allow-Headers:\ Origin,\ Accept,\ X-Requested-With,\ Content-Type,\ Access-Control-Request-Method,\ Access-Control-Reque$
   default_backend bk_cf_http

backend bk_cf_http
   balance roundrobin
   cookie JSESSIONID prefix nocache
   server s12 192.168.1.62:8090 check cookie s12
   server s13 192.168.1.63:8090 check cookie s13

frontend ft_cf_rtc_ssl
   bind :9083 ssl crt /etc/ssl/private/haproxy.pem
   default_backend bk_cf_rtc_ssl

backend bk_cf_rtc_ssl
  option tcp-check
  server s12 192.168.1.62:9083 check port 8090
  server s13 192.168.1.63:9083 check port 8090 backup
</code></pre>

<p><a href="#http-ssl-configuration-examples">See all HTTP+SSL configurations</a>.</p>

<hr />

<h2 id="https-configuration-examples">HTTPS configuration examples</h2>

<ul>
<li><a href="#https-direct-connection">HTTPS - direct connection</a></li>
</ul>

<p><img src="//media.balsamiq.com/img/support/docs/atlassian/https0.png" alt="" /></p>

<ul>
<li><a href="#https-proxy-on-different-server">HTTPS - proxy on different server</a></li>
</ul>

<p><img src="//media.balsamiq.com/img/support/docs/atlassian/https1.png" alt="" /></p>

<h3 id="https-direct-connection">HTTPS - direct connection</h3>

<p>Client connects (https) directly to Atlassian service. See the Prerequisites on <a href="#prerequisites">this section</a>. For CA chain please look also at <a href="#prerequisites-for-both-https-and-http-ssl">this section</a>.</p>

<p>Balsamiq servlet reads the following parameters directly from Atlassian server.xml inside the application https Connector.</p>

<pre><code>keystoreFile=&quot;/keystore-location&quot;
keystorePass=&quot;somethingLong&quot;
keystoreType=&quot;JKS&quot;
</code></pre>

<p><a href="#https-configuration-examples">See all HTTPS configurations</a>.</p>

<h3 id="https-proxy-on-different-server">HTTPS - proxy on different server</h3>

<p>Client connects (https) to reverse proxy that pass the request (https) to Atlassian service (on different machines). Reverse proxy redirect https instead of http. See the Prerequisites on <a href="#prerequisites">this section</a>. For CA chain please look also at <a href="#prerequisites-for-both-https-and-http-ssl">this section</a>.</p>

<h4 id="apache-configuration-file-example-ssl-ssl">apache configuration file example SSL - SSL</h4>

<pre><code>&lt;IfModule mod_ssl.c&gt;
    &lt;VirtualHost *:443&gt;
        ServerAdmin gozzi@balsamiq.com
        ServerName &lt;FQDN&gt;
        DocumentRoot /var/www/html
        ErrorLog ${APACHE_LOG_DIR}/error.log
        CustomLog ${APACHE_LOG_DIR}/access.log combined
        SSLEngine on
        SSLCertificateFile /etc/ssl/certs/apache-selfsigned.crt
        SSLCertificateKeyFile /etc/ssl/private/apache-selfsigned.key
        ProxyRequests Off
        &lt;Proxy *&gt;
           Require all granted
        &lt;/Proxy&gt;
        SSLProxyEngine on
###needed only if self signed and not imported
        SSLProxyVerify none
        SSLProxyCheckPeerCN off
        SSLProxyCheckPeerName off
        SSLProxyCheckPeerExpire off
### end optional
        ProxyPass /synchrony https://&lt;tomcatFQDN__or__tomcatStaticIP&gt;:8091/synchrony

    &lt;Location /synchrony&gt;
       Require all granted
       RewriteEngine on
       RewriteCond %{HTTP:UPGRADE} ^WebSocket$ [NC]
       RewriteCond %{HTTP:CONNECTION} Upgrade$ [NC]
       RewriteRule .* wss://&lt;tomcatFQDN__or__tomcatStaticIP&gt;:8091%{REQUEST_URI} [P]
     &lt;/Location&gt;

     ProxyPass &quot;/confluence/&quot;  &quot;https://&lt;tomcatFQDN__or__tomcatStaticIP&gt;:8443/confluence/&quot;
     ProxyPassReverse &quot;/confluence/&quot;  &quot;https://&lt;tomcatFQDN__or__tomcatStaticIP&gt;:8443/confluence/&quot;
    &lt;/VirtualHost&gt;
&lt;/IfModule&gt;


Listen &lt;FQDN__or__staticIP&gt;:9084
&lt;VirtualHost *:9084&gt;
     ServerName &lt;FQDN&gt;
     DocumentRoot /var/www/html
    SSLEngine on
    SSLCertificateFile      /etc/ssl/certs/apache-selfsigned.crt
    SSLCertificateKeyFile /etc/ssl/private/apache-selfsigned.key
    ProxyRequests off
   &lt;Proxy *&gt;
       Require all granted
    &lt;/Proxy&gt;
  ProxyPass /socket.io  https://&lt;tomcatFQDN__or__tomcatStaticIP&gt;:9084/socket.io
    &lt;Location /socket.io&gt;
    Require all granted
    RewriteEngine on
        RewriteCond %{HTTP:UPGRADE} ^WebSocket$ [NC]
        RewriteCond %{HTTP:CONNECTION} Upgrade$ [NC]
        RewriteRule .* wss://&lt;tomcatFQDN__or__tomcatStaticIP&gt;:9084%{REQUEST_URI} [P]
     &lt;/Location&gt;
  RewriteEngine on
  AllowEncodedSlashes on
    SSLProxyEngine on
###needed only if self signed and not imported
    SSLProxyVerify none
    SSLProxyCheckPeerCN off
    SSLProxyCheckPeerName off
    SSLProxyCheckPeerExpire off
###end optional
  ProxyPass / https://&lt;tomcatFQDN__or__tomcatStaticIP&gt;:9084/
  ProxyPassReverse / https://&lt;tomcatFQDN__or__tomcatStaticIP&gt;:9084/
&lt;/VirtualHost&gt;
</code></pre>

<h4 id="nginx-configuration-example-ssl-ssl">nginx configuration example SSL-SSL</h4>

<pre><code>server {
    server_name &lt;FQDN&gt;;
    listen &lt;FQDN__or__staticIP&gt;:443 ssl;

    ssl_certificate /etc/nginx/ssl/nginx.crt;
    ssl_certificate_key /etc/nginx/ssl/nginx.key;

    location /confluence {
      proxy_pass https://&lt;tomcatFQDN__or__tomcatStaticIP&gt;:8443/confluence;
      client_max_body_size 100M;
      proxy_buffer_size 8k;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header Host $host;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
}

upstream confluence_rtc {
        server &lt;tomcatFQDN__or__tomcatStaticIP&gt;:9083;
        keepalive 60;
}

server {
    server_name &lt;FQDN&gt;;
    listen &lt;FQDN__or__staticIP&gt;:9083 ssl;
    listen [::]:9083 ssl;
    proxy_read_timeout 86400s;
    ssl_certificate /etc/nginx/ssl/nginx.crt;
    ssl_certificate_key /etc/nginx/ssl/nginx.key;

    location / {
        proxy_pass https://confluence_rtc;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header Host $host;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;

        # WebSocket support (nginx 1.4)
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection &quot;upgrade&quot;;
   }
}
</code></pre>

<p><a href="#https-configuration-examples">See all HTTPS configurations</a>.</p>

<hr />

<p>If you run into any RTC issues (or are using a configuration different from these), please <a href="mailto:support@balsamiq.com">get in touch</a>. We are here to help however we can!</p>

            
          </div>
          
          <hr>
          <nav class="section-pager">
            <ul class="pager m0">
              <li class="previous">
              
                
                 
                <a href="https://mmclssg1.github.io/ssdocs/product3v3/server/wireframes/rtc-troubleshooting/"><span aria-hidden="true">&larr;</span> Real-Time Collaboration Service Troubleshooting</a>
                
                
              
              </li>

              <li class="next">
              
                
                
                <a href="https://mmclssg1.github.io/ssdocs/product3v3/server/wireframes/overview/">Editor Overview <span aria-hidden="true">&rarr;</span></a>
                
                
              
              </li>
            </ul>
          </nav>
          <hr>
          
         </article>
      </div>
    </div>
  </div>

</div> 


  </div>
</div>




<script>
			$(document).ready( function(){
				$("img[alt='gif']").gifplayer({ label: 'Play' });
			});
</script>

 </div>






    

  





</div>




<script>
anchors.options = {
  icon: '#',
  placement: 'left'
};
anchors.add('div.article-content.content.article h2, div.article-content.content.article h3');
</script>

</body>
</html>

